<div class="animate-fade-in">
    <div class="flex justify-between items-end mb-12">
        <div>
            <h1 class="text-4xl font-bold mb-2">System <span class="text-gradient">Admin</span></h1>
            <p class="text-text-muted">Global control of users, assessments, and authentication.</p>
        </div>
        <div class="flex p-1 bg-white/5 rounded-xl backdrop-blur-sm self-stretch md:self-auto">
            <button (click)="view.set('users')" [class.bg-primary]="view() === 'users'"
                [class.text-white]="view() === 'users'"
                class="px-6 py-2 rounded-lg text-sm font-bold transition-all text-text-dim hover:text-white">User
                Directory</button>
            <button (click)="view.set('tests')" [class.bg-primary]="view() === 'tests'"
                [class.text-white]="view() === 'tests'"
                class="px-6 py-2 rounded-lg text-sm font-bold transition-all text-text-dim hover:text-white">Test
                Catalog</button>
        </div>
    </div>

    @if (view() === 'users') {
    <div class="flex justify-between items-center mb-8">
        <h2 class="text-2xl font-bold">User <span class="text-gradient">Management</span></h2>
        <button (click)="openCreateUser()" class="btn btn-primary shadow-lg shadow-primary/20">+ Create User</button>
    </div>

    <div class="glass-pane overflow-hidden">
        <table class="w-full text-left">
            <thead>
                <tr
                    class="text-[10px] font-bold text-text-dim uppercase tracking-widest border-b border-white/5 bg-white/[0.02]">
                    <th class="px-8 py-5">Identity</th>
                    <th class="px-8 py-5">Privileges</th>
                    <th class="px-8 py-5 text-right">Actions</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-white/5">
                @for (user of users(); track user.id) {
                <tr class="hover:bg-white/[0.01] transition-colors">
                    <td class="px-8 py-6">
                        <div class="font-bold text-white">{{ user.username }}</div>
                        <div class="text-xs text-text-dim">{{ user.email }}</div>
                    </td>
                    <td class="px-8 py-6">
                        <span class="px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider"
                            [ngClass]="user.role === 'admin' ? 'bg-accent-error/10 text-accent-error' : (user.role === 'recruiter' ? 'bg-primary/10 text-primary' : 'bg-white/10 text-text-muted')">
                            {{ user.role }}
                        </span>
                    </td>
                    <td class="px-8 py-6 text-right">
                        <button (click)="deleteUser(user.id)"
                            class="p-2 hover:bg-accent-error/10 rounded-md text-text-dim hover:text-accent-error transition-all">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 6h18" />
                                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
                                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />
                            </svg>
                        </button>
                    </td>
                </tr>
                }
            </tbody>
        </table>
    </div>
    } @else {
    <div class="flex justify-between items-center mb-8">
        <h2 class="text-2xl font-bold">Comprehensive <span class="text-gradient">Catalog</span></h2>
    </div>
    <div class="glass-pane overflow-hidden">
        <table class="w-full text-left">
            <thead>
                <tr
                    class="text-[10px] font-bold text-text-dim uppercase tracking-widest border-b border-white/5 bg-white/[0.02]">
                    <th class="px-8 py-5">Assessment Module</th>
                    <th class="px-8 py-5">Ownership</th>
                    <th class="px-8 py-5 text-right">Management</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-white/5">
                @for (test of tests(); track test.id) {
                <tr class="hover:bg-white/[0.01] transition-colors">
                    <td class="px-8 py-6">
                        <div class="font-bold text-white">{{ test.title }}</div>
                        <div class="text-xs text-text-dim uppercase font-bold text-primary">{{ test.language }} • {{
                            test.duration }} mins</div>
                    </td>
                    <td class="px-8 py-6 text-text-muted text-sm font-medium">{{ test.creator?.username || 'System' }}
                    </td>
                    <td class="px-8 py-6 text-right">
                        <button (click)="deleteTest(test.id)"
                            class="p-2 hover:bg-accent-error/10 rounded-md text-text-dim hover:text-accent-error transition-all">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 6h18" />
                                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
                                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />
                            </svg>
                        </button>
                    </td>
                </tr>
                }
            </tbody>
        </table>
    </div>
    }
</div>

@if (showUserModal()) {
<div class="fixed inset-0 bg-black/80 backdrop-blur-md z-[100] flex items-center justify-center p-4 animate-fade-in">
    <div class="glass-pane max-w-[500px] w-full overflow-hidden shadow-[0_0_50px_rgba(0,0,0,0.5)]">
        <div class="px-10 py-8 border-b border-white/5 bg-white/[0.02] flex justify-between items-center">
            <div>
                <h2 class="text-2xl font-bold text-white">Provision <span class="text-gradient">User</span></h2>
                <p class="text-text-dim text-xs mt-1">Configure global authentication privileges.</p>
            </div>
            <button (click)="showUserModal.set(false)" class="text-text-dim hover:text-white">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18" />
                    <line x1="6" y1="6" x2="18" y2="18" />
                </svg>
            </button>
        </div>

        <form (ngSubmit)="saveUser()" class="p-10 space-y-6">
            <div>
                <label>Username</label>
                <input name="username" [(ngModel)]="userForm().username" class="input-field" placeholder="John Doe"
                    required>
            </div>
            <div>
                <label>Corporate Email</label>
                <input name="email" type="email" [(ngModel)]="userForm().email" class="input-field"
                    placeholder="john@example.com" required>
            </div>
            <div>
                <label>Initial Password</label>
                <input name="password" type="password" [(ngModel)]="userForm().password" class="input-field"
                    placeholder="••••••••" required>
            </div>
            <div>
                <label>Access Role</label>
                <select name="role" [(ngModel)]="userForm().role" class="input-field bg-[#0a0a0a]">
                    <option value="candidate">Candidate (Student)</option>
                    <option value="recruiter">Recruiter (Manager)</option>
                    <option value="admin">Admin (Root)</option>
                </select>
            </div>
            <div class="flex gap-4 pt-4">
                <button type="button" (click)="showUserModal.set(false)"
                    class="btn btn-secondary flex-1 justify-center">Cancel</button>
                <button type="submit" class="btn btn-primary flex-1 justify-center">Provision Account</button>
            </div>
        </form>
    </div>
</div>
}